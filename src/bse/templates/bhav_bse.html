{% load static %}

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Filterable table</title>
    <link rel="stylesheet" href="{% static 'bse/bse.css' %}" />
    <!-- <link rel="stylesheet" href="{% static 'bse/bse.js' %}" /> -->
  </head>
  <body>
    <h1 style="text-align: center">Bhavcopy BSE</h1>
    <div id="app">
      <table>
        <thead>
          <input type="text" placeholder="Filter by name" v-model="filter" />
          <tr>
            <th>SC_CODE</th>
            <th>SC_NAME</th>
            <th>OPEN</th>
            <th>LOW</th>
            <th>CLOSE</th>
          </tr>
        </thead>
        <tbody>
          <tr v-for="(row, index) in filteredRows" :key="`bhav-${index}`">
            <td v-html="highlightMatches(row.SC_CODE)"></td>
            <td v-html="highlightMatches(row.SC_NAME)"></td>
            <td v-html="highlightMatches(row.OPEN)"></td>
            <td v-html="highlightMatches(row.LOW)"></td>
            <td v-html="highlightMatches(row.CLOSE)"></td>
          </tr>
        </tbody>
      </table>
    </div>
  </body>

  <script src="https://cdn.jsdelivr.net/npm/vue@2.6.11/dist/vue.js"></script>
  <script>
    const app = new Vue({
      el: '#app',
      data: {
        filter: '',
        rows: {{bhav_data|safe}},
      },
      methods: {
        highlightMatches(text) {
          const matchExists = text.toLowerCase().includes(this.filter.toLowerCase());
          if (!matchExists) return text;

          const re = new RegExp(this.filter, 'ig');
          return text.replace(re, (matchedText) => `<strong>${matchedText}</strong>`);
        },
      },
      computed: {
        filteredRows() {
          return this.rows.filter((row) => {
            const names = row.SC_NAME.toLowerCase();
            const searchTerm = this.filter.toLowerCase();
            return names.includes(searchTerm)
          });
        },
      },
    });
  </script>
</html>
